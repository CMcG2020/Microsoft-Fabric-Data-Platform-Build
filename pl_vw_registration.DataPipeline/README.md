# Microsoft Fabric Data Pipeline - Dynamic View Creation

## Overview

This Microsoft Fabric data pipeline provides an end-to-end solution for dynamically generating and creating database views based on live table configurations. The pipeline automates the process of view creation by first generating view definitions through a notebook and then iteratively creating views for multiple tables in parallel.

## Pipeline Architecture

### Components

1. **Notebook Activity**: Generates view definitions and table mappings
2. **ForEach Loop**: Processes multiple tables in parallel batches
3. **Script Activity**: Creates or alters database views dynamically

### Workflow Diagram

```
┌─────────────────────────┐
│  Generate View          │
│  Definitions            │
│  (Notebook)             │
└─────────┬───────────────┘
          │
          ▼
┌─────────────────────────┐
│  ForEachTable           │
│  (Parallel Processing)  │
│  ┌─────────────────────┐│
│  │   Create View       ││
│  │   (Script)          ││
│  └─────────────────────┘│
└─────────────────────────┘
```

## Pipeline Activities

### 1. Generate View Definitions (TridentNotebook)

**Purpose**: Executes a notebook to analyze live tables and generate view definitions with column mappings.

**Configuration**:
- **Type**: TridentNotebook
- **Timeout**: 12 hours
- **Retry Policy**: 1 retry with 30-second intervals
- **Output**: JSON containing `live_table_names` and `table_column_map`

**Key Outputs**:
- `live_table_names`: Array of table names to process
- `table_column_map`: Mapping of tables to their respective columns

### 2. ForEachTable (ForEach Loop)

**Purpose**: Iterates through each table identified in the previous step and creates corresponding views.

**Configuration**:
- **Execution**: Parallel processing (non-sequential)
- **Batch Size**: 5 concurrent operations
- **Input**: Dynamic list from notebook output
- **Dependency**: Waits for "Generate View Definitions" to succeed

### 3. Create View (Script Activity)

**Purpose**: Dynamically creates or alters database views for each table.

**Configuration**:
- **Type**: SQL Script
- **Timeout**: 12 hours per view creation
- **Retry Policy**: 1 retry with 30-second intervals

**Dynamic SQL Generation**:
```sql
CREATE OR ALTER VIEW vw_[table_prefix] AS 
SELECT [dynamic_columns] FROM [source_table];
```

## Key Features

### Dynamic View Naming
- Views are named using the table prefix (everything before '_sv_')
- Format: `vw_[table_prefix]`

### Column Mapping
- Columns are dynamically selected based on the table-column mapping generated by the notebook
- Ensures only relevant columns are included in each view

### Parallel Processing
- Processes up to 5 tables simultaneously for improved performance
- Non-sequential execution reduces overall pipeline runtime

### Error Handling
- Built-in retry mechanisms for both notebook and script activities
- 12-hour timeout prevents indefinite hanging
- Dependency management ensures proper execution order

## Prerequisites

### Infrastructure Requirements
- Microsoft Fabric workspace
- Database connection with appropriate permissions
- Notebook with view definition logic

### Permissions Required
- Read access to source tables
- CREATE/ALTER VIEW permissions on target database
- Execute permissions on the notebook

## Configuration Parameters

### Environment-Specific Settings
- **Database**: Target database for view creation
- **Connection**: Database connection identifier
- **Notebook ID**: Reference to the view definition notebook
- **Workspace ID**: Microsoft Fabric workspace identifier

### Timeout Settings
- **Notebook Execution**: 12 hours
- **View Creation**: 12 hours per table
- **Retry Interval**: 30 seconds

## Usage Instructions

### Deployment
1. Import the pipeline JSON into your Microsoft Fabric workspace
2. Update connection references to match your environment
3. Ensure the notebook contains the required view definition logic
4. Configure database permissions for view creation

### Execution
1. The pipeline can be triggered manually or scheduled
2. Monitor the notebook execution for view definition generation
3. Track the ForEach loop progress for individual view creation
4. Verify created views in the target database

### Monitoring
- Check activity logs for each step
- Monitor parallel execution in the ForEach loop
- Validate view creation success in the database

## Expected Outputs

### Database Views
- Dynamically named views (format: `vw_[table_prefix]`)
- Views contain filtered columns based on table-column mapping
- Views reference source tables with '_sv_' naming convention

### Pipeline Artifacts
- Execution logs for each activity
- JSON output from notebook containing table and column mappings
- Success/failure status for each view creation

## Troubleshooting

### Common Issues
1. **Notebook Timeout**: Increase timeout or optimize notebook logic
2. **Permission Errors**: Verify database and view creation permissions
3. **Connection Issues**: Check database connection configuration
4. **View Creation Failures**: Review SQL syntax and table existence

### Debugging Steps
1. Check notebook output for proper JSON structure
2. Verify table names and column mappings
3. Test SQL generation logic manually
4. Review connection and permission settings

## Best Practices

### Performance Optimization
- Adjust batch size based on database capacity
- Monitor concurrent connections to avoid overload
- Optimize notebook execution for faster view definition generation

### Maintenance
- Regularly review and update view definitions
- Monitor pipeline execution times and optimize as needed
- Keep connection credentials and references up to date

## Version History

- **Current Version**: Initial implementation with dynamic view creation
- **Features**: Parallel processing, error handling, dynamic SQL generation

---

*This pipeline provides a scalable solution for maintaining database views in Microsoft Fabric environments, ensuring consistency and automation in view management processes.*